<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Join Tables Based on Events Occurring in Sequence • funneljoin</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Join Tables Based on Events Occurring in Sequence">
<meta property="og:description" content="Time-based joins to analyze sequence of events, 
    both in memory and out of memory. ">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">funneljoin</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/funneljoin.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->

<p><strong>Disclaimer</strong>: funneljoin is still in development. While we are frequently using it at DataCamp, there might be some bugs, especially with remote tables. If you can, we recommend pulling your data to work with locally. And <strong>do not</strong> do multiple funnel joins in a row remotely; you will get an error (it’s fine locally).</p>
<div id="overview" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1></div>
<p>The goal of funneljoin is to make it easy to analyze behavior funnels. For example, maybe you’re interested in finding the people who visit a page and then register. Or you want all the times people click on an item and add it to their cart within 2 days.</p>
<p>You can do this with funneljoin’s <code><a href="reference/after_join.html">after_join()</a></code> function. The arguments are:</p>
<ul>
<li>
<code>x</code>: a dataset with the first set of behaviors.</li>
<li>
<code>y</code>: a dataset with the second set of behaviors.</li>
<li>
<code>by_time</code>: a character vector to specify the time columns in x and y. This would typically be a datetime or a date column. These columns are used to filter for time y being after time x.</li>
<li>
<code>by_user</code>: a character vector to specify the user or identity columns in x and y.</li>
<li>
<code>mode</code>: the method used to join: “inner”, “full”, “anti”, “semi”, “right”, “left”. You can also use <code>after_mode_join</code> instead (e.g. <code>after_inner_join</code> instead of <code><a href="reference/after_join.html">after_join(..., mode = "inner")</a></code>)</li>
<li>
<code>type</code>: the type of funnel used to distinguish between event pairs, such as “first-first”, “last-first”, “any-firstafter”. See types of funnels for details.</li>
<li>
<code>max_gap</code> (optional): the maximum gap between events. Can be a integer representing the number of seconds between events or a difftime object.</li>
<li>
<code>gap_col</code> (optional): whether to return a numeric column, <code>.gap</code>, with the time difference in seconds between the events. Defaults to <code>FALSE</code>.</li>
</ul>
<p>As funneljoin uses dplyr, it can also work with remote tables, <strong>but has only been tried on postgres</strong>. Some of the functionality, especially the gap joins, use SQL code that may not work with different versions.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># install.packages("devtools")</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"datacamp/funneljoin"</span>)</a></code></pre></div>
</div>
<div id="types-of-funnels" class="section level2">
<h2 class="hasAnchor">
<a href="#types-of-funnels" class="anchor"></a>Types of funnels</h2>
<p><code>type</code> can be any combination of <code>first</code>, <code>last</code>, <code>any</code>, and <code>lastbefore</code> with <code>first</code>, <code>last</code>, <code>any</code>, and <code>firstafter</code>. Some common ones you may use include:</p>
<ul>
<li>
<strong>first-first</strong>: Take the earliest x and y for each user <strong>before</strong> joining. For example, you want the first time someone entered an experiment, followed by the first time someone <strong>ever</strong> registered. If they registered, entered the experiment, and registered again, you do not want to include that person.</li>
<li>
<strong>first-firstafter</strong>: Take the first x, then the first y after that. For example, you want when someone first entered an experiment and the first course they started afterwards. You don’t care if they started courses before entering the experiment.</li>
<li>
<strong>lastbefore-firstafter</strong>: First x that’s followed by a y before the next x. For example, in last click paid ad attribution, you want the last ad someone clicked before the first subscription they did afterward.</li>
<li>
<strong>any-firstafter</strong>: Take all Xs followed by the first Y after it. For example, you want all the times someone visited a homepage and their first product page they visited afterwards.</li>
<li>
<strong>any-any</strong>: Take all Xs followed by all Ys. For example, you want all the times someone visited a homepage and <strong>all</strong> the product pages they saw afterward.</li>
</ul>
<p>See the vignette for more examples.</p>
<div id="example" class="section level3">
<h3 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(funneljoin)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">landed &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="op">~</span>user_id, <span class="op">~</span>timestamp,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dv">1</span>, <span class="st">"2018-07-01"</span>,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  <span class="dv">2</span>, <span class="st">"2018-07-01"</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  <span class="dv">3</span>, <span class="st">"2018-07-02"</span>,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">  <span class="dv">4</span>, <span class="st">"2018-07-01"</span>,</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">  <span class="dv">4</span>, <span class="st">"2018-07-04"</span>,</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">  <span class="dv">5</span>, <span class="st">"2018-07-10"</span>,</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">  <span class="dv">5</span>, <span class="st">"2018-07-12"</span>,</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  <span class="dv">6</span>, <span class="st">"2018-07-07"</span>,</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">  <span class="dv">6</span>, <span class="st">"2018-07-08"</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">timestamp =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(timestamp))</a>
<a class="sourceLine" id="cb3-14" data-line-number="14"></a>
<a class="sourceLine" id="cb3-15" data-line-number="15">registered &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">  <span class="op">~</span>user_id, <span class="op">~</span>timestamp,</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">  <span class="dv">1</span>, <span class="st">"2018-07-02"</span>,</a>
<a class="sourceLine" id="cb3-18" data-line-number="18">  <span class="dv">3</span>, <span class="st">"2018-07-02"</span>,</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">  <span class="dv">4</span>, <span class="st">"2018-06-10"</span>,</a>
<a class="sourceLine" id="cb3-20" data-line-number="20">  <span class="dv">4</span>, <span class="st">"2018-07-02"</span>,</a>
<a class="sourceLine" id="cb3-21" data-line-number="21">  <span class="dv">5</span>, <span class="st">"2018-07-11"</span>,</a>
<a class="sourceLine" id="cb3-22" data-line-number="22">  <span class="dv">6</span>, <span class="st">"2018-07-10"</span>,</a>
<a class="sourceLine" id="cb3-23" data-line-number="23">  <span class="dv">6</span>, <span class="st">"2018-07-11"</span>,</a>
<a class="sourceLine" id="cb3-24" data-line-number="24">  <span class="dv">7</span>, <span class="st">"2018-07-07"</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-26" data-line-number="26"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">timestamp =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(timestamp))</a></code></pre></div>
<p>Let’s say we wanted to get only the first time people landed and registered. We would use a <code>first-first inner</code> join:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">landed <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/after_join.html">after_inner_join</a></span>(registered, </a>
<a class="sourceLine" id="cb4-3" data-line-number="3">                   <span class="dt">by_user =</span> <span class="st">"user_id"</span>,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                   <span class="dt">by_time =</span> <span class="st">"timestamp"</span>,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                   <span class="dt">type =</span> <span class="st">"first-first"</span>)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; # A tibble: 4 x 3</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;   user_id timestamp.x timestamp.y</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;     &lt;dbl&gt; &lt;date&gt;      &lt;date&gt;     </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; 1       1 2018-07-01  2018-07-02 </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; 2       3 2018-07-02  2018-07-02 </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; 3       6 2018-07-07  2018-07-10 </span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; 4       5 2018-07-10  2018-07-11</span></a></code></pre></div>
<p>If your time and user columns have different names, you can work with that too:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">landed &lt;-<span class="st"> </span>landed <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">landed_at =</span> timestamp,</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">         <span class="dt">user_id_x =</span> user_id)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">registered &lt;-<span class="st"> </span>registered <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">registered_at =</span> timestamp,</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">         <span class="dt">user_id_y =</span> user_id)</a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">landed <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/after_join.html">after_inner_join</a></span>(registered, </a>
<a class="sourceLine" id="cb6-3" data-line-number="3">                   <span class="dt">by_user =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"user_id_x"</span> =<span class="st"> "user_id_y"</span>),</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">                   <span class="dt">by_time =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"landed_at"</span> =<span class="st"> "registered_at"</span>),</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">                   <span class="dt">type =</span> <span class="st">"first-first"</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; # A tibble: 4 x 3</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt;   user_id_x landed_at  registered_at</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt;       &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;       </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; 1         1 2018-07-01 2018-07-02   </span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; 2         3 2018-07-02 2018-07-02   </span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; 3         6 2018-07-07 2018-07-10   </span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; 4         5 2018-07-10 2018-07-11</span></a></code></pre></div>
</div>
</div>
<div id="summarizing-funnels" class="section level2">
<h2 class="hasAnchor">
<a href="#summarizing-funnels" class="anchor"></a>Summarizing funnels</h2>
<p>Funneljoin also contains two functions to summarize funnels: <code><a href="reference/summarize_conversions.html">summarize_conversions()</a></code> and <code><a href="reference/summarize_prop_tests.html">summarize_prop_tests()</a></code>- see the vignette for details.</p>
</div>
<div id="reporting-bugs-and-adding-features" class="section level2">
<h2 class="hasAnchor">
<a href="#reporting-bugs-and-adding-features" class="anchor"></a>Reporting bugs and adding features</h2>
<p>If you find any bugs or have a feature request or question, please <a href="https://github.com/datacamp/funneljoin/issues/new">create an issue</a>. If you’d like to add a feature, tests, or other functionality, please also make an issue first and let’s discuss!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Emily Robinson <br><small class="roles"> Author, maintainer </small>  </li>
<li>Anthony Baker <br><small class="roles"> Author </small>  </li>
<li>David Robinson <br><small class="roles"> Author </small>  </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/datacamp/funneljoin"><img src="https://travis-ci.org/datacamp/funneljoin.svg?branch=master" alt="Travis-CI Build Status"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Emily Robinson, Anthony Baker, David Robinson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
